{% extends 'base.html' %} 

{# 
  ARQUIVO: servicos.html (COM VOCABUL√ÅRIO DIN√ÇMICO E FORMATA√á√ÉO DE HORAS)
  Adapta para "Di√°rias" ou "Servi√ßos" e formata 1440min como "1 Dia".
#}

{% block title %}
  {# T√≠tulo da Aba #}
  {% if current_user.barbearia.business_type == 'pousada' %}
      Gerir Di√°rias
  {% else %}
      Gerir Servi√ßos
  {% endif %}
{% endblock %}

{% block content %}

  {# ================================================================= #}
  {# üß† C√âREBRO DO VOCABUL√ÅRIO (SERVI√áOS)                            #}
  {# ================================================================= #}
  {% set termo_singular = 'Servi√ßo' %}
  {% set termo_plural = 'Servi√ßos' %}
  
  {% if current_user.is_authenticated and current_user.barbearia %}
      {% set tipo = current_user.barbearia.business_type %}
      {% set nome = current_user.barbearia.nome_fantasia.lower() %}

      {# POUSADA #}
      {% if tipo == 'pousada' or 'pousada' in nome %}
          {% set termo_singular = 'Di√°ria / Pacote' %}
          {% set termo_plural = 'Tipos de Di√°ria' %}
      
      {# LASH #}
      {% elif 'lash' in nome or 'studio' in nome %}
          {% set termo_singular = 'Procedimento' %}
          {% set termo_plural = 'Procedimentos' %}
      {% endif %}
  {% endif %}
  {# ================================================================= #}

  {# Mensagens Flash #}
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        {% set color_class = 'bg-blue-500' %}
        {% if category == 'success' %}{% set color_class = 'bg-green-500' %}{% endif %}
        {% if category == 'danger' %}{% set color_class = 'bg-red-500' %}{% endif %}
        {% if category == 'warning' %}{% set color_class = 'bg-yellow-500' %}{% endif %}
        
        <div class="{{ color_class }} text-white p-4 rounded-lg mb-6 flex justify-between items-center shadow-lg" role="alert">
          <span>{{ message }}</span>
          <button type="button" onclick="this.parentElement.remove()">
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  {# Cabe√ßalho da P√°gina #}
  <div class="flex justify-between items-center mb-6">
    <h2 class="text-text-primary-dark text-3xl font-bold">{{ termo_plural }}</h2>
    
    {# Bot√£o Novo Item #}
    <a href="{{ url_for('servicos.novo_servico') }}" 
       class="flex cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-lg h-12 px-6 bg-primary text-white text-base font-bold hover:bg-primary/90 transition-colors">
      <span class="material-symbols-outlined">add</span>
      <span class="truncate">Novo {{ termo_singular }}</span>
    </a>
  </div>

  {# Tabela #}
  <div class="bg-surface-dark rounded-xl shadow-lg overflow-x-auto">
    <table class="w-full min-w-[600px] lg:min-w-full text-left align-middle">
      <thead class="bg-background-dark">
        <tr>
          <th class="p-4 text-sm font-semibold text-text-secondary-dark uppercase">Nome</th>
          <th class="p-4 text-sm font-semibold text-text-secondary-dark uppercase">Dura√ß√£o</th>
          <th class="p-4 text-sm font-semibold text-text-secondary-dark uppercase">Pre√ßo (R$)</th>
          <th class="p-4 text-sm font-semibold text-text-secondary-dark uppercase text-center">A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        {% for servico in servicos %}
          <tr class="border-b border-gray-800 hover:bg-white/5">
            {# Nome #}
            <td class="p-4 font-semibold text-text-primary-dark">{{ servico.nome }}</td>
            
            {# Dura√ß√£o Inteligente (Transforma minutos em Dias/Horas) #}
            <td class="p-4 text-text-primary-dark">
                {% if servico.duracao == 1440 %}
                    <span class="px-2 py-1 bg-blue-500/20 text-blue-400 rounded text-xs font-bold border border-blue-500/30">1 Dia (24h)</span>
                {% elif servico.duracao == 720 %}
                    <span class="px-2 py-1 bg-yellow-500/20 text-yellow-400 rounded text-xs font-bold border border-yellow-500/30">12 Horas (Day Use)</span>
                {% else %}
                    {{ servico.duracao }} min
                {% endif %}
            </td>

            {# Pre√ßo #}
            <td class="p-4 text-green-400 font-mono font-medium">R$ {{ "%.2f"|format(servico.preco) }}</td>
            
            {# A√ß√µes #}
            <td class="p-4 text-center">
              <a href="{{ url_for('servicos.editar_servico', servico_id=servico.id) }}" 
                 class="p-2 text-text-secondary-dark hover:text-primary rounded-full transition-colors" title="Editar">
                <span class="material-symbols-outlined">edit</span>
              </a>
              <form action="{{ url_for('servicos.apagar_servico', servico_id=servico.id) }}" 
                    method="post" class="inline" onsubmit="return confirm('Tem certeza que deseja apagar \'{{ servico.nome }}\'?');">
                <button type="submit" class="p-2 text-text-secondary-dark hover:text-red-500 rounded-full transition-colors" title="Apagar">
                  <span class="material-symbols-outlined">delete</span>
                </button>
              </form>
            </td>
          </tr>
        {% else %} 
          <tr>
            <td colspan="4" class="p-8 text-center text-text-secondary-dark">
                Nenhum {{ termo_singular|lower }} cadastrado ainda.
            </td>
          </tr>
        {% endfor %} 
      </tbody>
    </table>
  </div>

{% endblock %}
