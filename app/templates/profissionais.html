{% extends 'base.html' %} 

{# 
  ARQUIVO: profissionais.html (COM VOCABUL√ÅRIO DIN√ÇMICO BLINDADO)
  Adapta os textos para "Quartos", "Designers" ou "Profissionais".
#}

{% block title %}
  {% if current_user.barbearia.business_type == 'pousada' or 'pousada' in current_user.barbearia.nome_fantasia.lower() %}
      Gerir Quartos
  {% elif 'lash' in current_user.barbearia.nome_fantasia.lower() %}
      Gerir Designers
  {% else %}
      Gerir Profissionais
  {% endif %}
{% endblock %}

{% block content %}

  {# ================================================================= #}
  {# üß† C√âREBRO DO VOCABUL√ÅRIO LOCAL (BLINDADO COM NAMESPACE)        #}
  {# ================================================================= #}
  
  {% set vocab_local = namespace(singular='Profissional', plural='Profissionais', icon='person') %}

  {% if current_user.is_authenticated and current_user.barbearia %}
      {% set tipo = current_user.barbearia.business_type %}
      {% set nome = current_user.barbearia.nome_fantasia.lower() %}

      {# POUSADA #}
      {% if tipo == 'pousada' or 'pousada' in nome %}
          {% set vocab_local.singular = 'Quarto' %}
          {% set vocab_local.plural = 'Quartos' %}
          {% set vocab_local.icon = 'bed' %}

      {# LASH #}
      {% elif 'lash' in nome or 'studio' in nome %}
          {% set vocab_local.singular = 'Designer' %}
          {% set vocab_local.plural = 'Designers' %}
          {% set vocab_local.icon = 'face_3' %}
      {% endif %}
  {% endif %}
  {# ================================================================= #}

  {# Mensagens Flash #}
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        {% set color_class = 'bg-blue-500' %}
        {% if category == 'success' %}{% set color_class = 'bg-green-500' %}{% endif %}
        {% if category == 'danger' %}{% set color_class = 'bg-red-500' %}{% endif %}
        {% if category == 'warning' %}{% set color_class = 'bg-yellow-500' %}{% endif %}
        
        <div class="{{ color_class }} text-white p-4 rounded-lg mb-6 flex justify-between items-center shadow-lg" role="alert">
          <span>{{ message }}</span>
          <button type="button" onclick="this.parentElement.remove()">
            <span class="material-symbols-outlined">close</span>
          </button>
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  {# Cabe√ßalho da P√°gina #}
  <div class="flex justify-between items-center mb-6">
    {# T√≠tulo Din√¢mico #}
    <h2 class="text-text-primary-dark text-3xl font-bold">{{ vocab_local.plural }}</h2>
    
    {# Bot√£o Din√¢mico #}
    <a href="{{ url_for('profissionais.novo_profissional') }}" 
       class="flex cursor-pointer items-center justify-center gap-2 overflow-hidden rounded-lg h-12 px-6 bg-primary text-white text-base font-bold hover:bg-primary/90 transition-colors shadow-lg shadow-primary/20">
      <span class="material-symbols-outlined">add</span>
      <span class="truncate">Novo {{ vocab_local.singular }}</span>
    </a>
  </div>

  {# Tabela #}
  <div class="bg-surface-dark rounded-xl shadow-lg overflow-x-auto border border-white/5">
    <table class="w-full min-w-[400px] lg:min-w-full text-left align-middle">
      <thead class="bg-background-dark/50">
        <tr>
          {# Coluna Nome Din√¢mica #}
          <th class="p-4 text-sm font-semibold text-text-secondary-dark uppercase tracking-wider">Nome do {{ vocab_local.singular }}</th>
          <th class="p-4 text-sm font-semibold text-text-secondary-dark uppercase tracking-wider text-center">A√ß√µes</th>
        </tr>
      </thead>
      <tbody>
        {% for profissional in profissionais %}
          <tr class="border-b border-gray-800/50 hover:bg-white/5 transition-colors">
            <td class="p-4 font-semibold text-text-primary-dark flex items-center gap-3">
                {# √çcone ao lado do nome (Cama ou Pessoa) #}
                <div class="bg-primary/10 p-2 rounded-lg flex items-center justify-center">
                    <span class="material-symbols-outlined text-primary">{{ vocab_local.icon }}</span>
                </div>
                {{ profissional.nome }}
            </td>
            <td class="p-4 text-center space-x-2">
              <a href="{{ url_for('profissionais.editar_profissional', profissional_id=profissional.id) }}" 
                 class="inline-flex items-center justify-center p-2 text-text-secondary-dark hover:text-primary hover:bg-primary/10 rounded-lg transition-all" title="Editar">
                <span class="material-symbols-outlined text-xl">edit</span>
              </a>
              <form action="{{ url_for('profissionais.apagar_profissional', profissional_id=profissional.id) }}" 
                    method="post" class="inline" onsubmit="return confirm('Tem certeza que deseja apagar o {{ vocab_local.singular|lower }} \'{{ profissional.nome }}\'?');">
                <button type="submit" class="inline-flex items-center justify-center p-2 text-text-secondary-dark hover:text-red-500 hover:bg-red-500/10 rounded-lg transition-all" title="Apagar">
                  <span class="material-symbols-outlined text-xl">delete</span>
                </button>
              </form>
            </td>
          </tr>
        {% else %} 
          <tr>
            <td colspan="2" class="p-12 text-center">
                <div class="flex flex-col items-center justify-center text-text-secondary-dark">
                    <span class="material-symbols-outlined text-6xl mb-4 opacity-20">{{ vocab_local.icon }}</span>
                    <p class="text-lg">Nenhum {{ vocab_local.singular|lower }} cadastrado ainda.</p>
                </div>
            </td>
          </tr>
        {% endfor %} 
      </tbody>
    </table>
  </div>

{% endblock %}
